<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

		<title>Abdullah - Contacts Dashboard</title>
		<link href="https://fonts.googleapis.com/css?family=Poppins:300i,400,400i,500,600,700,800" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css" >	
		
		<link rel="icon" href="project/3595030.png"/>		
		
		<link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
		
		<link rel="stylesheet" type="text/css" href="assets/fonts/font-awesome.min.css">
		<link rel="stylesheet" type="text/css" href="assets/fonts/simple-line-icons.css">
		<link rel="stylesheet" type="text/css" href="assets/css/slicknav.css">
		<link rel="stylesheet" type="text/css" href="assets/css/owl.carousel.min.css">
		<link rel="stylesheet" type="text/css" href="assets/css/owl.theme.default.min.css">
		<link rel="stylesheet" type="text/css" href="assets/css/nivo-lightbox.css" >
		<link rel="stylesheet" type="text/css" href="assets/css/animated-headline.css" >
		<link rel="stylesheet" type="text/css" href="assets/css/normalize.css">
		<link rel="stylesheet" type="text/css" href="assets/css/animate.css">
		<link rel="stylesheet" type="text/css" href="assets/css/main.css">
		<link rel="stylesheet" type="text/css" href="assets/css/responsive.css">					
		</head>
    
  <style>
    body {
      font-family: 'Poppins', sans-serif; /* Use Poppins from your link */
      background: #000000b1;
      margin: 0;
      padding: 0;
    }

    .table-container {
      max-width: 1300px; /* Slightly wider */
      margin: 50px auto;
      background: #000000f8;
      padding: 30px; /* More padding */
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08); /* Softer shadow */
    }

    .dashboard-header {
      text-align: center;
      margin-bottom: 30px;
      color: #333;
    }
    
    .dashboard-header h2 {
        font-weight: 600;
        margin-bottom: 5px;
        color: #ff0;
    }
    .dashboard-header p {
        color: #777;
        font-size: 15px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      border-radius: 10px;
      overflow: hidden; /* Important for rounded corners */
      /* border: 1px solid #ff0; */
    }

    thead {
      /* background: linear-gradient(135deg, #667eea, #764ba2); */
    background:linear-gradient(135deg, rgb(151 204 88 / 20%) 0%, transparent 100%);

      color: #fff;
    }

    th, td {
      padding: 15px 15px; /* More padding */
      text-align: left;
      font-size: 14px;
      color: #ffffff;
    }
    
    th:last-child, td:last-child {
        text-align: center; /* Center the action button */
    }

    tbody tr {
      border-bottom: 1px solid #eee;
      transition: background-color 0.3s ease;
    }

    /* tbody tr:hover {
      background: #f4f6ff;
    } */

    /* Styling for the Delete button */
    .delete-btn {
      background: #e74c3c;
      border: none;
      color: #fff;
      padding: 8px 15px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: background-color 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }

    .delete-btn:hover {
      background: #c0392b;
    }

    .empty-row {
      text-align: center;
      font-weight: 500;
      color: #777;
      padding: 20px;
    }

    /* Small screens responsiveness */
    @media (max-width: 992px) {
      .table-container {
        margin: 20px;
        padding: 15px;
      }
      table, thead, tbody, th, td, tr {
        display: block;
      }
      thead tr {
        position: absolute;
        top: -9999px;
        left: -9999px;
      }
      tr { border: 1px solid #ccc; margin-bottom: 10px; }
      td {
        border: none;
        border-bottom: 1px solid #eee;
        position: relative;
        padding-left: 50%;
        text-align: right;
      }
      td:before {
        position: absolute;
        top: 0;
        left: 6px;
        width: 45%;
        padding-right: 10px;
        white-space: nowrap;
        text-align: left;
        font-weight: bold;
        color: #555;
      }
      /* Label the data fields */
      td:nth-of-type(1):before { content: "Name:"; }
      td:nth-of-type(2):before { content: "Email:"; }
      td:nth-of-type(3):before { content: "Subject:"; }
      td:nth-of-type(4):before { content: "Message:"; }
      td:nth-of-type(5):before { content: "Timestamp:"; }
      td:nth-of-type(6):before { content: "Action:"; }
      
      /* Make the action button cell look better on small screens */
      td:last-child {
        text-align: center;
        padding-left: 15px; /* Remove left padding from the label */
      }
      td:last-child:before {
          content: ""; /* Hide the label for the action button */
      }
      .delete-btn { margin: 5px auto; }
    }
  </style>
  

  <script>
  let login_status = sessionStorage.getItem("login_status");
  if (login_status !== "true") {
      window.location.href = "login.html";
  }
  </script>
	<body >
    <button id="logoutButton" style="position:fixed;top:80px;right:50px;background:#ff0;color:#000;border:none;padding:10px 15px;border-radius:6px;font-weight:600;cursor:pointer;">
Logout
</button>
<script>
document.getElementById("logoutButton").addEventListener("click", function () {
    sessionStorage.removeItem("login_status");
    window.location.href = "login.html";
});
</script>

        <div class="table-container ">
            <div class="dashboard-header">
                <h2><i class='bx bxs-dashboard'></i> Contacts Dashboard</h2>
                <p>Manage messages received through your portfolio contact form.</p>
            </div>
            <table id="contactsTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Subject</th>
                        <th>Message</th>
                        <th>Timestamp</th>
                        <th>Action</th> </tr>
                </thead>
                <tbody>
                    </tbody>
            </table>
        </div>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { 
    getFirestore, 
    collection, 
    getDocs, 
    query, 
    orderBy, 
    deleteDoc, // Import deleteDoc
    doc // Import doc
  } 
    from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  // Firebase config (Make sure this is your actual config)
  const firebaseConfig = {
    apiKey: "AIzaSyBNZR3MHVLAj8bqPMqNsmGFKyWMnmrt7Hg",
    authDomain: "abdullahprotfolio.firebaseapp.com",
    projectId: "abdullahprotfolio",
    storageBucket: "abdullahprotfolio.firebasestorage.app",
    messagingSenderId: "314684931200",
    appId: "1:314684931200:web:81d83daa4a2c91c14f7a65",
    measurementId: "G-XVBCZ4HKNE"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const CONTACTS_COLLECTION = "contacts"; // Collection name constant

  /**
   * Deletes a contact document from Firestore.
   * @param {string} docId The ID of the document to delete.
   */
  async function handleDelete(docId) {
    if (confirm("Are you sure you want to delete this contact message?")) {
      try {
        const contactDocRef = doc(db, CONTACTS_COLLECTION, docId);
        await deleteDoc(contactDocRef);
        alert("Message deleted successfully!");
        loadContacts(); // Reload the table to reflect the change
      } catch (error) {
        console.error("Error deleting document:", error);
        alert("Error deleting message. Check the console for details.");
      }
    }
  }

  // Attach handleDelete to the window object so it can be called from the row HTML
  window.handleDelete = handleDelete;

  // Fetch data from Firestore and populate table
  async function loadContacts() {
    const tableBody = document.querySelector("#contactsTable tbody");
    tableBody.innerHTML = ""; // Clear existing rows
    const loadingRow = document.createElement("tr");
    loadingRow.innerHTML = `<td colspan="6" class="empty-row"><i class='bx bx-loader-alt bx-spin'></i> Loading contacts...</td>`;
    tableBody.appendChild(loadingRow);


    try {
      const q = query(collection(db, CONTACTS_COLLECTION), orderBy("timestamp", "desc"));
      const querySnapshot = await getDocs(q);
      
      tableBody.innerHTML = ""; // Clear loading row

      if (querySnapshot.empty) {
          const emptyRow = document.createElement("tr");
          emptyRow.innerHTML = `<td colspan="6" class="empty-row"><i class='bx bx-info-circle'></i> No contact messages found.</td>`;
          tableBody.appendChild(emptyRow);
          return;
      }


      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const docId = doc.id; // Get the document ID
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${data.name || "N/A"}</td>
          <td>${data.email || "N/A"}</td>
          <td>${data.subject || "N/A"}</td>
          <td>${data.message || "N/A"}</td>
          <td>${data.timestamp ? data.timestamp.toDate().toLocaleString() : "N/A"}</td>
          <td>
            <button class="delete-btn" onclick="window.handleDelete('${docId}')">
              <i class='bx bx-trash'></i> Delete
            </button>
          </td>
        `;
        tableBody.appendChild(row);
      });
    } catch (error) {
      console.error("Error fetching contacts:", error);
      tableBody.innerHTML = "";
      const errorRow = document.createElement("tr");
      errorRow.innerHTML = `<td colspan="6" class="empty-row" style="color:#e74c3c;"><i class='bx bx-error-alt'></i> Error loading data. See console.</td>`;
      tableBody.appendChild(errorRow);
    }
  }

  // Load contacts on page load
  window.addEventListener('DOMContentLoaded', loadContacts);
</script>

    </body>
</html> 